===========================================================================
【ソ フ ト名】　NCVC - NC(Gcode) Viewer and Converter Ver3.63a
【登  録  名】　ncvc363a.zip
【著作権  者】　眞柄　賢一
【対応  ＯＳ】　Windows Xp以降（全VerOSで動作確認したわけではありません）
【掲  載  日】　2017/08/22
【ソフト種別】　フリーソフト
【転載  条件】　事後でも連絡
===========================================================================

【ソフト紹介】
　一言で言うとフリー（無料）のＣＡＭソフトです。主な機能は以下の通り。

・２次元汎用ＣＡＤで製図した図形情報(DXF)から、ＮＣコードを生成。
　ＣＡＤはＤＸＦ出力可能、かつ、レイヤ名が出力できるものであれば、
　普段使い慣れたソフトでＯＫ！
・ＮＣコードの切削シミュレーション。
・ＮＣコードから各平面(XY,XZ,YZ)単位の２次元ＤＸＦデータ(R12形式)も出力可能。
・アドインＩ／Ｆによりユーザサイドの拡張。
　JW_CADデータ(JWW/JWC)が直接読み込めます。

一応基本的な機能は備えたつもりですが、まだまだ発展途上です。
いずれ「フリーでここまでできるのか！」というくらいまでは...(^o^)v


【ファイルリスト】
　ncvc363a.zipには、次のファイルがあります。
NCVC.exe             ： 本体
Init.mnc             ： 機械情報のサンプル
Lathe.mnc            ： 機械情報のサンプル(旋盤)
Wire.mnc             ： 機械情報のサンプル(ワイヤ)
Init.nci             ： 切削条件ファイルのサンプル
Init.ncj             ： 旋盤データ生成用の切削条件ファイルサンプル
Init.ncw             ： ワイヤ放電加工機生成用の切削条件ファイルサンプル
Laser.nci            ： レーザ加工機用の切削条件ファイルサンプル
Deep.nci             ： 切削条件ファイルのサンプル２(深彫パラメータ)
Header.txt           ： NC生成のカスタムヘッダーファイル
Footer.txt           ： NC生成のカスタムフッダーファイル
HeaderLathe.txt      ： 旋盤用のカスタムヘッダーファイル
FooterLathe.txt      ： 旋盤用のカスタムフッダーファイル
HeaderWire.txt       ： ワイヤ放電用のカスタムヘッダーファイル
FooterWire.txt       ： ワイヤ放電用のカスタムフッダーファイル
HeaderLaser.txt      ： レーザ加工機用のカスタムヘッダーファイル
NCVCcolor.ini        ： お薦めカラーテーブル
---------------------------------------------------------------------
Gcode.txt            ： NCVC対応Ｇコード一覧表
GcodeLathe.txt       ： 　　〃　（旋盤モード差分）
GcodeWire.txt        ： 　　〃　（ワイヤ加工機モード差分）
Readme.txt           ： 本ファイル
sample\sample1.jww   ： サンプルのJW_CADファイル
sample\sample1.ncd   ： サンプルのNCコード
sample\deep.ncd      ： Deep.nciで処理したNCコード
sample\sample2.jww   ： 2.5D切削のサンプルJW_CADファイル
sample\sample2.ncl   ： sample2.jww用2.5D加工条件データ
sample\sample2.ncd   ： 2.5D切削のNCコード
sample\sample3.jww   ： 形状加工のサンプルJW_CADファイル
sample\sample3.cam   ： 形状加工のサンプルCAMファイル
sample\sample3.ncd   ： 形状加工のNCコード
sample\maizuru.jww   ： 文字サンプルのJW_CADデータ
sample\maizuru.ncd   ： 文字サンプルのNCコード
sample\lathe.jww     ： 旋盤モードのサンプルCADデータ
sample\lathe.ncd     ： 旋盤モードのサンプルNCコード
sample\wire_fig*.jww ： ワイヤ放電モードのサンプルCADデータ
sample\wire_fig*.cam ： ワイヤ放電モードのサンプルCAMファイル
sample\wire_fig*.ncd ： ワイヤ放電モードのサンプルNCコード

(※)
Ver0.14.00以降、アドインの同梱は廃止しました。最新のアドイン取得には
NCVCのホームページから必要な分をダウンロードしてください。
## インストーラバージョンはフルパッケージからインストールの選択が可能


【インストール】
　適当なディレクトリに解凍してください。
アドイン類はEXE本体と同じディレクトリに格納してください。
すでにインストールされている方は、
切削条件ファイルやカスタムヘッダーファイル等を上書きしない方がいいでしょう。
(使えるキーワードが増えている場合があるので、都度ご確認ください)
## インストーラバージョンは上書きインストールも可能
## 既に古いバージョンをインストール済みでも
## 「アプリケーションのインストールと削除」に複数掲載されることはありません。


【使用方法】
　ＮＣコードの切削シミュレーションは、ＮＣデータ(*.ncd)を開けば
その切削イメージが表示されます。表示色はカスタマイズ可能。
ＮＣデータ生成手順は以下の通り。

　　(1)ＣＡＤでの製図で、
　　　 ・切削したい線や円(弧)の軌跡、穴加工(実点or円)データを切削レイヤに
　　　 ・工作機械の原点を示す円(中心が工作機械の原点を表す)を原点レイヤに
　　　 ・上記２点は必須。必要に応じて加工開始時の移動パスを表す線or円は
　　　 　加工開始指示レイヤに、切削途中の強制移動指示は移動レイヤに
　　　 を作図。それぞれのレイヤに名前を設定してください。
　　　 以下はNCVCが読み込むデフォルトレイヤ名です。 

　　　　　切削レイヤ：CAM
　　　　　原点レイヤ：ORIGIN
　　　　　加工開始指示レイヤ　：デフォルトなし
　　　　　強制移動指示レイヤ　：デフォルトなし
　　　　　コメント用文字レイヤ：デフォルトなし

　　(2)ＤＸＦ形式で保存。ＤＸＦではそれぞれのＣＡＤ特有の情報が消える可能性が
　　　 あるので、念のためご使用のＣＡＤ独自の形式でも保存(JWW/DWG etc.)。

　　(3)NCVCでＤＸＦを開きます。正しく読むことが出来ればメニューから
　　　「ＮＣ変換」が選択できます。とりあえずそのままＯＫ

　　(4)生成されたＮＣデータがシミュレーションされます。

(3)にてデフォルトの切削条件(init.nci)を指定しましたが、もちろんそれぞれの加工
条件に合わせて設定してあげてください。切削条件ファイルはテキストファイルで保存
されますので、それぞれの加工条件にあった複数の条件ファイルを作っておくと効果的
です。
その他注意点として、

・現在のNCVCは軌跡切削なので使用する工具径を考慮しながら製図する必要がありま
　す。つまり輪郭加工やポケット加工を行う場合は、製図段階で複線による工具分の
　オフセット、または、ポケット加工を行うような軌跡を製図する必要があります。
　(*1)
・加工開始位置指示と強制移動指示のデータは必須ではありません。
　機械原点からの最短移動では工具が干渉してしまう、加工効率を上げるため早送り
　ポイントを指示したいなど、必要に応じて指定してください
・現在のＮＣコード生成エンジンは、基本的に２次元ＤＸＦデータを切削条件ファイル
　に従って３次元加工するだけのことですので、(まだ)Ｚ軸の動的な切削コントロール
　はできません(*2)。したがってネームプレート的な加工やワイヤー加工機などの２Ｄ
　切削に最適でしょう
・ＮＣデータ生成の探索ルールは、「一筆書き(オイラーグラフ)」を採用しています。
　出来るだけ同一Ｚ軸で一筆書き切削できるようなパスを生成(*3)しますが、まだそれ
　ほど賢くありません。あたたかく見守って下さい(^^;)

(*1)Ver1.00以降の形状認識処理を使えば、オフセット演算が可能になりました。
(*2)拡張ＮＣ生成機能（複数レイヤによる一括生成）を使えば、疑似2.5D切削
（等高線切削）も可能です。
(*3)端点での一筆書きのみ。交点での線分割は行いません

一度実行されると、ncd や cam の拡張子に関連づけされます。
関連づけされた後は、エクスプローラから
それぞれの拡張子をダブルクリックするだけで起動できます。
（エクスプローラからのＤ＆Ｄも可能）


【制限事項】
・対応するＧコードは Gcode.txt を参照してください。


【アンインストールについて】
　プログラム情報をレジストリに記録しています。
\HKEY_CURRENT_USER\Software\MNCT-S\NCVC を消去してください。
あと、.ncd と .cam 拡張子に関連づけされますので、それらも削除してください。
（レジストリエディタの検索で探せばでてきます）
## インストーラバージョンでインストールされた環境では、
## 「アプリケーションのインストールと削除」からアンインストール可能です


【再配布・商利用】
　再配布・ご利用に関して、次の条件を守ってください。
・基本的に再配布可能ですが、
  ・取得したアーカイバのまま配布
  ・事後でも連絡
・商用に関しては上記の条件に加え、
  ・NCVCをメインとするような商利用は厳禁
  ・NCVCをバンドルする場合でも、その商品のパッケージやマニュアル類などに
　　著作権表示と再配布条件を必ず明記すること
　ここでいう商用とは、NCVCがソフトウェアとして販売目的に用いられることを
　言います。NCVCの機能を用いて制作・加工した製品はこの限りではありません。


【著作権・知的所有権に関して】
　NCVC本体、および、それにまつわる各種成果物は
舞鶴工業高等専門学校教育研究支援センターの眞柄賢一が著作権を保有します。
アドインやスクリプトは各作者の著作物です。
著作権等を侵害するような行為は堅くお断りいたします。


【免責事項】
　本プログラム使用による損害等は作者は一切責任を持ちません。
特に生成したＮＣデータは加工前に厳重なチェックをお願いします。
また仕様変更義務も持ちませんが、これについてはもちろん良心的に対処します。
どしどし希望・要望をお寄せください。


【変更履歴】
3.63 → 3.63a への変更は
・バグレポート
　：CADデータの読み込み設定で、切削レイヤの正規表現に
　　間違ったコードを入力すると、落ちていたバグを修正
　　→正規表現を正しく構築するための例外処理を追加した
　：ワイヤ放電加工機用生成で、上下異形状切削の開始ポイントがおかしかった
　　バグを修正
　：ワイヤ用の切削条件設定で、[新規保存]ボタンが効かなかったバグを修正
　：形状認識処理後に保存したCAMファイルが読めなかったバグを修正
　　→32ビット版と64ビット版の間で互換性もなかったバグも同時に修正
　：形状認識処理で加工指示を消すDelキーが効かなくなる場合があったバグを修正
　：CADデータがアクティブのとき、アドインと外部アプリのツールチップヒントが
　　出ずに「引数が正しくありません」と表示されていたバグを修正
　：サムネイルでNCデータを開くとき、フォルダのデータがちょうど9個なら、
　　スクロールバーの動作がおかしかったバグを修正
　：NCプログラムのリストビューがアクティブなとき、
　　ブレイク(F9)などのショートカットキーが効かなかったバグを修正

3.62a → 3.63 への変更は
・ＮＣ表示
　：(Endmill=C_)の書式を追加 先端角90度の面取りミルを再現します
　　→Cに続く数値はRと同じ半径です
　：工作機械設定の工具情報に工具タイプを追加
　　→Ｔ番号から3種類のエンドミル先端形状を再現できます
　：OpenGLタブでのトレース速度ＵＰ（ほんの少し）
　：OpenGLタブでトレース中にウィンドウが非アクティブになると
　　トレースを一時停止するように変更
　　→一応の安全対策ですが、応答なしで止まるときゃ止まる...

3.62 → 3.62a への変更は
・バグレポート
　：OpenGLタブでトレース中にウィンドウサイズを変更すると落ちていたバグを修正
　：OpenGLタブでのトレースで、工具径補正データが含まれるNCプログラムの
　　工具描画位置が補正前になっていたバグを修正
・他
　：64bit版に向けて変数の型を調整

3.61 → 3.62 への変更は
・全般
　：LARGEADDRESSAWAREオプションを設定し、メモリ使用制限を緩和
　　→緩和対象は64bitOSの場合のみです
・ＮＣ表示
　：内部精度を倍精度から単精度に変更
　　→上記オプションと併せ、読み込めるデータサイズが拡大
　　　当方の実験で約60MB300万ブロックまでは処理できています
　：古いビデオカード(OpenGL1.5未満)の場合はOpenGLタブが出ないようにした
　：表示属性のOpenGL設定で、ソリッド描画が無効になっていると
　　OpenGLタブが出ないようにした
　：OpenGLでのレンダリング速度の改善（当社比約３０％）
　：読み込み時のOpenGLソリッド表示でレンダリングの処理推移を
　　フレームのステータスバーに表示するようにした
　　→サイズの大きいデータを処理するときの目安に
　：OpenGLタブでトレース描画ができるようになった
　　→切削アニメーションはしません。１ブロックの結果が表示されますが遅いです...
　　　また、トレース中は軌跡表示されません（ワイヤ加工機モードを除く）。
・バグレポート
　：形状認識処理でPOLYLINE(DXF)の輪郭認識が誤っていた（厳しすぎた）バグを修正
　：形状認識処理のオフセット交点除去を行うと、落ちる場合があったバグを修正

3.60b → 3.61 への変更は
・ＮＣ生成
　：『生成後に実行するPerlスクリプト』を切削条件に追加
　　→毎回変換スクリプトを実行していた場合に便利です
・他
　：統合モードで配置した子データ上にマウスを置くと
　　ファイル名を表示（チップヘルプ）するようにした

3.60a → 3.60b への変更は
・他
　：統合後の削除機能へのショートカットキーをDelからShift+Delに変更
　：カスタムヘッダー・フッターの置換ワードに２バイト文字が含まれていると
　　"???"で置換していましたが、廃止しました。(BindFileとの整合性です)
　　→対象ワードは、MakeUser, MakeNCD, MakeDXF, MakeCondition の４つです
　　　加工機側でエラーとなる場合は、これらの置換ワードを消してください
・バグレポート
　：POLYLINE(DXF)を含むデータを形状認識処理し、そこから形状加工生成を行うと
　　NCプログラムが正しく生成できない場合があったバグを修正
　：POLYLINE(DXF)で方向指示が効かなかったバグを修正
　　→CAMデータで保存している場合は一度方向指示を消して指示しなおしてください
　：統合生成を行うとカスタムヘッダーの置換ワード MakeNCD, MakeDXF が
　　最初に生成される子データから参照されていたバグを修正
　：統合生成の［ﾌｧｲﾙごとにｺﾒﾝﾄを埋め込む］オプションで
　　ファイル名が空っぽになってしまうバグを修正

3.60 → 3.60a への変更は
・バグレポート
　：同じ選択状態のデータを連続して移動できないバグを修正
　：選択後の移動開始タイミングが、子エリアを出ないと発動しないバグを修正
　：形状認識処理でPOLYLINE(DXF)の輪郭認識が誤認識するバグを修正

3.52a → 3.60 への変更は
・ＣＡＤ系
　：CADデータの統合配置機能（複数データの読み込み）を実装
　　→詳細は別途マニュアルを参照
・ＤＸＦ出力
　：TABLEセクションにレイヤ名"0"を必ず出力するようにした
　　→AutoCAD対策
　：CAD系メニューにもDXF出力を追加
　　→統合データもDXF出力できますが個々の図形情報として出力されます
　　　色はAutoCAD上のインデックスカラーに一番近い色番号で出力されます
　　　配置情報等も記録したい場合はCAMデータとして保存してください
・表示系全般
　：直前の拡大率（Ctrl+Z）廃止
　　代わりにCADデータ統合での「移動を元に戻す」を実装
・他
　：開発環境をVS2015に移行
　　→MFCランタイムが変わっていますのでご注意を
・バグレポート
　：深彫での円データのヘリカル切削で終了条件が甘かったバグを修正
　：POLYLINEを含むDXFデータで、形状認識処理からの加工指示を行い、
　　それをCAMファイルとして保存すると、そのCAMファイル読み込みで落ちる
　　バグを修正
　：同上のデータで方向指示後にNC生成すると落ちるバグを修正
　：NCプログラム内に２バイト文字があると落ちるバグを修正

過去の変更履歴および詳細は、
http://s-gikan2.maizuru-ct.ac.jp/xcl/ からリンクを
参照してください。


【バグレポート】
　バグレポート及び要望・サポートなどは、『NCVC掲示板』をご利用願います。

NCVC掲示板
http://s-gikan2.maizuru-ct.ac.jp/xcl/
から「掲示板」リンクをクリック

★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
ヘルプが不備のため、後発の方への情報源として、できるだけ掲示板をご利用くだ
さい。既に質問内容とその解決策が掲示されているかもしれません。
念のため作者メールアドレスも記載していますが、メールでのお問い合わせには答
えられない場合もあります。
E-mail:magara[at]maizuru-ct.ac.jp
舞鶴工業高等専門学校　教育研究支援センター　眞柄　賢一 宛まで。
★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★


【謝辞】
　本プログラム作成にあたり、
・影ながら応援していただいている、
　またＣＡＤサンプル配布を快諾していただいた、
　(有)古谷工機　古谷 義博様
・スプラッシュウィンドウご提供の
　金田 誠輝様
・「円データによる穴加工」のアイデアを頂いた
　福岡 正幸様
・ワイヤー加工機での切削テストご協力の
　CBR1100XX 様
・NCVCcolor.ini 雛形ご提供の
　wistra 様
・さまざまな方面からの支援・援助いただいている
　本校教育研究支援センター技術職員
　　石井 貴弘様、能勢 嘉朗様
　京都大学工学研究科精密工学
　　佐藤 祐司様
　京都府立工業高等学校機械プランニング科
　　桂 延裕様
・NCVCテスターを始め、バリバリ使い込んでいる皆様(^^;)
各位には、この場を借りて感謝の意を表します。

なお、本プログラムの研究開発の一部は、
・平成12年度舞鶴工業高等専門学校重点研究費
・平成13年度日本学術振興会科学研究費補助金(奨励研究(B)No.13919089)
・平成21年度日本学術振興会科学研究費補助金(奨励研究No.21919030)
・平成25年度日本学術振興会科学研究費補助金(奨励研究No.25917025)
により遂行されたことを付記します。


【開発環境】
ＣＰＵ　　　：Corei7-3770K 3.5GHz
メモリ　　　：16GB
ビデオ　　　：GeForce GTX 780
ＯＳ　　　　：Windows 10 Enterprise(64bit)
　　　　　　　FreeBSD 8.3-RELEASE(部分的な関数チェックに)
開発言語　　：VisualC++ 2015
　　　　　　　gcc4.2.2
ライブラリ　：MFC, boost-1.65.0, GLEW-2.00, FreeGLUT-3.00
